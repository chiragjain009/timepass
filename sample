import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import streamlit as st

def getQuarterwiseChart(df):
    # Convert the 'ACT_DATE' column to datetime
    df['ACT_DATE'] = pd.to_datetime(df['ACT_DATE'], format='%d-%b-%y')
    
    # Extract Year and Quarter
    df['ACT_YEAR'] = df['ACT_DATE'].dt.year
    df['ACT_QUARTER'] = df['ACT_DATE'].dt.quarter
    
    # Group data by Year and Quarter
    year_quarter_count = df.groupby(['ACT_YEAR', 'ACT_QUARTER']).size().reset_index(name='quarter_count')
    # st.write(year_quarter_count)  # Uncomment to display data in Streamlit for debugging

    # Streamlit UI
    st.title('Yearly Data Analysis')
    
    # User selects the year
    selected_year = st.selectbox('Select Year', sorted(df['ACT_YEAR'].unique()))
    
    # Filter data for the selected year
    filtered_year_df = df[df['ACT_YEAR'] == selected_year]
    filtered_year_df_count = (
        filtered_year_df.groupby('ACT_QUARTER')
        .size()
        .reset_index(name='filter_count')
    )

    # Map quarter numbers to labels
    quarter_labels = filtered_year_df_count['ACT_QUARTER'].map({
        1: '1st Quarter',
        2: '2nd Quarter',
        3: '3rd Quarter',
        4: '4th Quarter'
    })

    # Plotting
    fig, ax = plt.subplots(figsize=(6, 4))
    sns.barplot(
        x=quarter_labels,
        y=filtered_year_df_count['filter_count'],
        palette="coolwarm",
        edgecolor="black",
        ax=ax
    )
    ax.set_xlabel('Quarter-wise', fontsize=10)
    ax.set_ylabel('Total Number of Records', fontsize=10)
    ax.set_title(f'Records Count per Quarter for Year {selected_year}', fontsize=12, fontweight='bold')
    ax.tick_params(axis='both', which='major', labelsize=8)
    plt.xticks(rotation=15)

    # Display plot in Streamlit
    st.pyplot(fig)
